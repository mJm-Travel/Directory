<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>mJm Partners</title>
  <meta name="description" content="Live directory of mJm Partners" />
  <style>
    body {
      font-family: Inter, system-ui, sans-serif;
      background: #0f1724;
      color: #e6eef8;
      margin: 0;
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin-bottom: 10px;
    }
    #search {
      padding: 10px 14px;
      border-radius: 6px;
      border: none;
      width: 100%;
      max-width: 400px;
      margin-bottom: 30px;
      font-size: 16px;
      background: #1b2437;
      color: #e6eef8;
    }
    #partnersGrid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
      width: 100%;
      max-width: 1100px;
    }
    .card {
      background: #182235;
      border-radius: 10px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      text-align: center;
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: scale(1.03);
    }
    .card img {
      width: 100%;
      aspect-ratio: 16 / 10;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .title {
      font-weight: 600;
      color: #eaf6ff;
      font-size: 15px;
      margin-bottom: 4px;
    }
    a {
      color: #7dd3fc;
      text-decoration: none;
    }
    .hidden {
      display: none;
    }
    footer {
      margin-top: 40px;
      color: #9aa6bf;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>mJm Partners</h1>
  <input id="search" type="text" placeholder="Search partners by title..." />

  <section id="partnersGrid">
    <p id="loading">Loading partners...</p>
  </section>

  <footer>
    Data auto-updates from Google Sheets.
  </footer>

  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTo_6mNyBKO1R5rI94bqFpXQv6dMHPE6-XG5CYY-fIOLgazA3tJ0bPvq_jSxAJCMAgtf3j8qzdJitR1/pub?output=csv";
    const grid = document.getElementById('partnersGrid');
    const searchInput = document.getElementById('search');

    async function loadPartners() {
      try {
        const res = await fetch(SHEET_URL);
        const csvText = await res.text();
        const rows = csvText.trim().split("\n").map(r => r.split(","));
        const headers = rows.shift().map(h => h.trim().toLowerCase());
        const titleIndex = headers.indexOf("title");
        const urlIndex = headers.indexOf("site_url");
        const imageIndex = headers.indexOf("image_url");

        const cards = rows.map(r => {
          const title = r[titleIndex]?.trim();
          const url = r[urlIndex]?.trim();
          const img = r[imageIndex]?.trim();

          return `
            <article class="card" data-title="${title.toLowerCase()}">
              <a href="${url}" target="_blank" rel="noopener">
                <img src="${img}" alt="${title}" />
                <div class="title">${title}</div>
                <div><small>${url.replace(/^https?:\/\//, "")}</small></div>
              </a>
            </article>`;
        }).join("");

        grid.innerHTML = cards || "<p>No partners found.</p>";
      } catch (err) {
        grid.innerHTML = `<p style='color:red'>Error loading data. Make sure the sheet is public.</p>`;
        console.error(err);
      }
    }

    // Simple client-side filter
    searchInput.addEventListener("input", e => {
      const query = e.target.value.toLowerCase();
      document.querySelectorAll(".card").forEach(card => {
        const match = card.dataset.title.includes(query);
        card.classList.toggle("hidden", !match);
      });
    });

    loadPartners();
  </script>
</body>
</html>
